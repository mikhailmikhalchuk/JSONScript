{
  "namespace": "Metal.MetalLayer",
  "functions": [
    {
      "name": "create",
      "params": [{"name": "device", "type": "*void"}],
      "locals": [
        {"name": "cls",              "type": "*void"},
        {"name": "layer",            "type": "*void"},
        {"name": "setDeviceSel",     "type": "*void"},
        {"name": "setPixelFmtSel",   "type": "*void"},
        {"name": "setDrawableSizeSel", "type": "*void"}
      ],
      "type": "*void",
      "body": [
        {
          "let": {"name": "cls", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "getClass",
              "args": {"className": {"string": "CAMetalLayer"}}}
          }}
        },
        {
          "let": {"name": "layer", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "init",
              "args": {"obj": {
                "call": {"namespace": "Metal.ObjC", "function": "alloc",
                  "args": {"cls": "cls"}}
              }}}
          }}
        },
        {
          "let": {"name": "setDeviceSel", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "sel",
              "args": {"selectorName": {"string": "setDevice:"}}}
          }}
        },
        {
          "call": {"namespace": "Metal.ObjC", "function": "msgSend1",
            "args": {
              "receiver": "layer",
              "selector": "setDeviceSel",
              "arg0":     "device"
            }}
        },
        {
          "let": {"name": "setPixelFmtSel", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "sel",
              "args": {"selectorName": {"string": "setPixelFormat:"}}}
          }}
        },
        {
          "call": {"namespace": "Metal.ObjC", "function": "msgSend1Int",
            "args": {
              "receiver": "layer",
              "selector": "setPixelFmtSel",
              "arg0":     80
            }}
        },
        {
          "let": {"name": "setDrawableSizeSel", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "sel",
              "args": {"selectorName": {"string": "setDrawableSize:"}}}
          }}
        },
        {
          "ffi": {
            "lib": "/usr/lib/libobjc.dylib",
            "symbol": "objc_msgSend",
            "args": [
              {"value": "layer",             "type": "*void"},
              {"value": "setDrawableSizeSel","type": "*void"},
              {"value": 800.0,               "type": "float64"},
              {"value": 600.0,               "type": "float64"}
            ],
            "returns": "void"
          }
        },
        { "return": "layer" }
      ]
    },
    {
      "name": "nextDrawable",
      "params": [{"name": "layer", "type": "*void"}],
      "locals": [
        {"name": "sel",    "type": "*void"},
        {"name": "result", "type": "*void"}
      ],
      "type": "*void",
      "body": [
        {
          "let": {"name": "sel", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "sel",
              "args": {"selectorName": {"string": "nextDrawable"}}}
          }}
        },
        {
          "let": {"name": "result", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "msgSend0",
              "args": {"receiver": "layer", "selector": "sel"}}
          }}
        },
        { "return": "result" }
      ]
    },
    {
      "name": "getTexture",
      "params": [{"name": "drawable", "type": "*void"}],
      "locals": [
        {"name": "sel",    "type": "*void"},
        {"name": "result", "type": "*void"}
      ],
      "type": "*void",
      "body": [
        {
          "let": {"name": "sel", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "sel",
              "args": {"selectorName": {"string": "texture"}}}
          }}
        },
        {
          "let": {"name": "result", "value": {
            "call": {"namespace": "Metal.ObjC", "function": "msgSend0",
              "args": {"receiver": "drawable", "selector": "sel"}}
          }}
        },
        { "return": "result" }
      ]
    }
  ]
}