{
  "namespace": "MetalRenderer",
  "functions": [
    {
      "name": "drawRect",
      "params": [
        {"name": "layer",        "type": "*void"},
        {"name": "commandQueue", "type": "*void"},
        {"name": "x",            "type": "float"},
        {"name": "y",            "type": "float"},
        {"name": "w",            "type": "float"},
        {"name": "h",            "type": "float"},
        {"name": "r",            "type": "float"},
        {"name": "g",            "type": "float"},
        {"name": "b",            "type": "float"}
      ],
      "locals": [
        {"name": "drawable",      "type": "*void"},
        {"name": "texture",       "type": "*void"},
        {"name": "rpd",           "type": "*void"},
        {"name": "commandBuffer", "type": "*void"},
        {"name": "encoder",       "type": "*void"}
      ],
      "body": [
        {
          "let": {"name": "drawable", "value": {
            "call": {"namespace": "MetalLayer", "function": "nextDrawable",
              "args": {"layer": "layer"}}
          }}
        },
        {
          "let": {"name": "texture", "value": {
            "call": {"namespace": "MetalLayer", "function": "getTexture",
              "args": {"drawable": "drawable"}}
          }}
        },
        {
          "let": {"name": "rpd", "value": {
            "call": {"namespace": "MetalPipeline", "function": "createRenderPassDescriptor",
              "args": {"texture": "texture"}}
          }}
        },
        {
          "let": {"name": "commandBuffer", "value": {
            "call": {"namespace": "MetalPipeline", "function": "createCommandBuffer",
              "args": {"commandQueue": "commandQueue"}}
          }}
        },
        {
          "let": {"name": "encoder", "value": {
            "call": {"namespace": "MetalPipeline", "function": "createEncoder",
              "args": {
                "commandBuffer": "commandBuffer",
                "rpd":           "rpd"
              }}
          }}
        },
        {
          "call": {"namespace": "MetalPipeline", "function": "endEncoding",
            "args": {"encoder": "encoder"}}
        },
        {
          "call": {"namespace": "MetalPipeline", "function": "presentDrawable",
            "args": {
              "commandBuffer": "commandBuffer",
              "drawable":      "drawable"
            }}
        },
        {
          "call": {"namespace": "MetalPipeline", "function": "commit",
            "args": {"commandBuffer": "commandBuffer"}}
        }
      ]
    }
  ]
}